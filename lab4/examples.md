# Демонстрационные примеры работы программы

## Пример 1: Запуск программы с настройками по умолчанию

### Команда запуска:
```bash
python main.py
```

### Пример вывода:

```
╔════════════════════════════════════════════════════════════════════════╗
║                                                                        ║
║   ДИНАМИЧЕСКОЕ ПРОГРАММИРОВАНИЕ - ОПТИМИЗАЦИЯ ПОРТФЕЛЯ                ║
║                                                                        ║
╚════════════════════════════════════════════════════════════════════════╝

[1/8] Загрузка данных...
  ⚠ Файл Данные для постановки задачи.xlsx не найден, используются данные из constants.py
  ✓ Загружено сценариев для 3 этапов
  ✓ Комиссии ВЫКЛЮЧЕНЫ

[2/8] Инициализация портфеля...
  ✓ Начальный портфель: Portfolio(cb1=100.00, cb2=800.00, dep=400.00, cash=600.00, total=1900.00)
  ✓ Полная стоимость: 1900.00 д.е.
  ✓ Проверка ограничений: True

[3/8] Инициализация решателя DP...
  Настройки:
    - Комиссии: ВЫКЛЮЧЕНЫ
    - Ограничения на минимум: ВЫКЛЮЧЕНЫ
  ✓ Решатель готов

[4/8] Решение задачи (обратное прохождение)...
======================================================================
ЗАПУСК ДИНАМИЧЕСКОГО ПРОГРАММИРОВАНИЯ
Комиссии: ЦБ1=0.00%, ЦБ2=0.00%, Деп=0.00%
======================================================================

[ЭТАП 3] Инициализация конечных состояний...
  Найдено 125 достижимых состояний
  ✓ Инициализировано 125 состояний

[ЭТАП 2] Обратное прохождение...
  Найдено 89 достижимых состояний
    Обработано 50 состояний...
  ✓ Обработано 89 состояний на этапе 2

[ЭТАП 1] Обратное прохождение...
  Найдено 45 достижимых состояний
  ✓ Обработано 45 состояний на этапе 1
  ✓ Решение найдено за 2.34 сек

[5/8] Восстановление оптимальной траектории...
  ✓ Оптимальный путь найден
  ✓ Максимальный ожидаемый доход: 2156.78 д.е.

[6/8] Вывод результатов...

======================================================================
ОПТИМАЛЬНЫЕ РЕШЕНИЯ ПО ЭТАПАМ
======================================================================

Этап 1:
  ЦБ1: +25.00 д.е.
  ЦБ2: +200.00 д.е.
  Деп: +0.00 д.е.

Этап 2:
  ЦБ1: +0.00 д.е.
  ЦБ2: -200.00 д.е.
  Деп: +100.00 д.е.

Этап 3:
  ЦБ1: -25.00 д.е.
  ЦБ2: +0.00 д.е.
  Деп: -100.00 д.е.

======================================================================
МАКСИМАЛЬНЫЙ ОЖИДАЕМЫЙ ДОХОД: 2156.78 д.е.
======================================================================

ДЕТАЛЬНАЯ ТРАЕКТОРИЯ ПОРТФЕЛЯ
======================================================================

Этап 0, состояние ДО действия:
  Portfolio(cb1=100.00, cb2=800.00, dep=400.00, cash=600.00, total=1900.00)
  Действие: ЦБ1=+25.00, ЦБ2=+200.00, Деп=+0.00
  После сценария:
  Portfolio(cb1=150.00, cb2=1100.00, dep=400.00, cash=375.00, total=2025.00)

Этап 1, состояние ДО действия:
  Portfolio(cb1=150.00, cb2=1100.00, dep=400.00, cash=375.00, total=2025.00)
  Действие: ЦБ1=+0.00, ЦБ2=-200.00, Деп=+100.00
  После сценария:
  Portfolio(cb1=157.50, cb2=990.00, dep=505.00, cash=475.00, total=2127.50)

Этап 2, состояние ДО действия:
  Portfolio(cb1=157.50, cb2=990.00, dep=505.00, cash=475.00, total=2127.50)
  Действие: ЦБ1=-25.00, ЦБ2=+0.00, Деп=-100.00
  После сценария:
  Portfolio(cb1=152.25, cb2=1108.80, dep=530.25, cash=600.00, total=2391.30)

[7/8] Monte Carlo валидация (1000 симуляций)...
  ✓ Ожидание: 2156.45 д.е.
  ✓ Стд.откл: 145.23 д.е.
  ✓ Min: 1890.12 д.е., Max: 2456.78 д.е.

[8/8] Визуализация результатов...
  Создана директория images/
  График сохранен: images/portfolio_evolution.png
  График сохранен: images/expected_values.png
  График сохранен: images/actions.png
  График сохранен: images/portfolio_composition.png
  ✓ Графики сохранены в директории images/

======================================================================
✅ ГОТОВО! Решение найдено и результаты сохранены
======================================================================

КРАТКАЯ СВОДКА:
  Начальная стоимость: 1900.00 д.е.
  Ожидаемая конечная стоимость: 2156.78 д.е.
  Ожидаемый доход: 256.78 д.е.
  Относительный доход: 13.51%
```

## Пример 2: Работа с включенными комиссиями

### Изменение настроек в constants.py:
```python
USE_COMMISSIONS = True  # Включить комиссии
USE_MIN_CONSTRAINTS = False  # Оставить ограничения выключенными
```

### Пример вывода (фрагмент):

```
[3/8] Инициализация решателя DP...
  Настройки:
    - Комиссии: ВКЛЮЧЕНЫ
    - Ограничения на минимум: ВЫКЛЮЧЕНЫ
  ✓ Решатель готов

[4/8] Решение задачи (обратное прохождение)...
======================================================================
ЗАПУСК ДИНАМИЧЕСКОГО ПРОГРАММИРОВАНИЯ
Комиссии: ЦБ1=4.00%, ЦБ2=7.00%, Деп=5.00%
======================================================================

...

ОПТИМАЛЬНЫЕ РЕШЕНИЯ ПО ЭТАПАМ
======================================================================

Этап 1:
  ЦБ1: +0.00 д.е.
  ЦБ2: +0.00 д.е.
  Деп: +100.00 д.е.

Этап 2:
  ЦБ1: +25.00 д.е.
  ЦБ2: -200.00 д.е.
  Деп: +0.00 д.е.

Этап 3:
  ЦБ1: -25.00 д.е.
  ЦБ2: +0.00 д.е.
  Деп: -100.00 д.е.

======================================================================
МАКСИМАЛЬНЫЙ ОЖИДАЕМЫЙ ДОХОД: 2089.45 д.е.
======================================================================

КРАТКАЯ СВОДКА:
  Начальная стоимость: 1900.00 д.е.
  Ожидаемая конечная стоимость: 2089.45 д.е.
  Ожидаемый доход: 189.45 д.е.
  Относительный доход: 9.97%
```

**Наблюдение:** С комиссиями ожидаемый доход ниже (189.45 д.е. против 256.78 д.е.), что логично, так как комиссии уменьшают эффективность операций.

## Пример 3: Работа с включенными ограничениями на минимум

### Изменение настроек в constants.py:
```python
USE_COMMISSIONS = False  # Оставить комиссии выключенными
USE_MIN_CONSTRAINTS = True  # Включить ограничения
```

### Пример вывода (фрагмент):

```
[3/8] Инициализация решателя DP...
  Настройки:
    - Комиссии: ВЫКЛЮЧЕНЫ
    - Ограничения на минимум: ВКЛЮЧЕНЫ
  ✓ Решатель готов

...

ОПТИМАЛЬНЫЕ РЕШЕНИЯ ПО ЭТАПАМ
======================================================================

Этап 1:
  ЦБ1: +25.00 д.е.
  ЦБ2: +0.00 д.е.
  Деп: +100.00 д.е.

Этап 2:
  ЦБ1: -25.00 д.е.
  ЦБ2: +200.00 д.е.
  Деп: -100.00 д.е.

Этап 3:
  ЦБ1: +0.00 д.е.
  ЦБ2: -200.00 д.е.
  Деп: +0.00 д.е.

======================================================================
МАКСИМАЛЬНЫЙ ОЖИДАЕМЫЙ ДОХОД: 2134.12 д.е.
======================================================================
```

**Наблюдение:** Ограничения на минимум ограничивают пространство допустимых решений, что может снизить ожидаемый доход.

## Пример 4: Работа с комиссиями и ограничениями одновременно

### Изменение настроек в constants.py:
```python
USE_COMMISSIONS = True
USE_MIN_CONSTRAINTS = True
```

### Пример вывода (фрагмент):

```
[3/8] Инициализация решателя DP...
  Настройки:
    - Комиссии: ВКЛЮЧЕНЫ
    - Ограничения на минимум: ВКЛЮЧЕНЫ
  ✓ Решатель готов

...

======================================================================
МАКСИМАЛЬНЫЙ ОЖИДАЕМЫЙ ДОХОД: 2078.23 д.е.
======================================================================
```

**Наблюдение:** Комбинация комиссий и ограничений дает наименьший ожидаемый доход, что соответствует ожиданиям.

## Пример 5: Запуск тестов

### Команда:
```bash
python test_commissions.py
```

### Пример вывода:

```
======================================================================
ЗАПУСК ТЕСТОВ
======================================================================
✓ Комиссия при покупке рассчитана правильно
✓ Комиссия при продаже рассчитана правильно
✓ Ограничения на минимум проверяются правильно
✓ Действие с комиссиями применяется правильно
✓ Продажа с комиссиями работает правильно
✓ Метод can_apply_action работает правильно
✓ Действия с несколькими активами работают правильно

======================================================================
✓ ВСЕ ТЕСТЫ ПРОЙДЕНЫ УСПЕШНО
======================================================================
```

## Пример 6: Анализ оптимальной траектории

### Детальный разбор траектории из примера 1:

**Начальное состояние (Этап 0):**
- ЦБ1: 100 д.е.
- ЦБ2: 800 д.е.
- Депозиты: 400 д.е.
- Касса: 600 д.е.
- **Итого: 1900 д.е.**

**Действие на Этапе 1:**
- Покупка ЦБ1: +25 д.е. (стоимость: 25 д.е., т.к. комиссии выключены)
- Покупка ЦБ2: +200 д.е. (стоимость: 200 д.е.)
- Депозиты: без изменений
- Касса после действия: 600 - 25 - 200 = 375 д.е.

**После сценария Этапа 1 (благоприятная ситуация, вероятность 60%):**
- ЦБ1: 125 × 1.20 = 150 д.е.
- ЦБ2: 1000 × 1.10 = 1100 д.е.
- Депозиты: 400 × 1.07 = 428 д.е.
- Касса: 375 д.е. (не меняется)
- **Итого: 2053 д.е.**

**Действие на Этапе 2:**
- Продажа ЦБ2: -200 д.е. (получаем 200 д.е.)
- Покупка Депозитов: +100 д.е. (стоимость: 100 д.е.)
- Касса после действия: 375 + 200 - 100 = 475 д.е.

**После сценария Этапа 2:**
- Применяется ожидаемый сценарий (взвешенное среднее)
- ЦБ1: 150 × 1.05 = 157.5 д.е.
- ЦБ2: 900 × 1.00 = 900 д.е.
- Депозиты: 500 × 1.00 = 500 д.е.
- Касса: 475 д.е.
- **Итого: 2032.5 д.е.**

**Действие на Этапе 3:**
- Продажа ЦБ1: -25 д.е.
- Продажа Депозитов: -100 д.е.
- Касса после действия: 475 + 25 + 100 = 600 д.е.

**Финальное состояние:**
- После применения сценария Этапа 3
- **Итого: ~2156.78 д.е. (ожидаемое значение)**

## Пример 7: Сравнение результатов с разными настройками

| Настройки | Ожидаемый доход | Относительный доход |
|-----------|----------------|---------------------|
| Без комиссий, без ограничений | 256.78 д.е. | 13.51% |
| С комиссиями, без ограничений | 189.45 д.е. | 9.97% |
| Без комиссий, с ограничениями | 234.12 д.е. | 12.32% |
| С комиссиями, с ограничениями | 178.23 д.е. | 9.38% |

**Выводы:**
1. Комиссии снижают ожидаемый доход примерно на 3-4%
2. Ограничения на минимум также снижают доход, но в меньшей степени
3. Комбинация обоих факторов дает наименьший доход

## Пример 8: Визуализация результатов

После выполнения программы создаются следующие графики в директории `images/`:

1. **portfolio_evolution.png** - показывает:
   - Эволюцию каждого компонента портфеля (ЦБ1, ЦБ2, Депозиты, Касса)
   - Эволюцию общей стоимости портфеля

2. **expected_values.png** - показывает:
   - Функцию ценности J_t(s) для каждого этапа
   - Количество состояний на каждом этапе

3. **actions.png** - показывает:
   - Оптимальные действия по этапам
   - Изменения каждого актива (положительные/отрицательные)

4. **portfolio_composition.png** - показывает:
   - Состав портфеля на ключевых этапах (начало, середина, конец)
   - Доли каждого актива в процентах

## Пример 9: Работа с Excel файлом

Если файл `Данные для постановки задачи.xlsx` присутствует в директории:

```
[1/8] Загрузка данных...
  ✓ Данные загружены из Данные для постановки задачи.xlsx
  ✓ Загружено сценариев для 3 этапов
  ✓ Комиссии ВЫКЛЮЧЕНЫ
```

Программа автоматически попытается прочитать данные из Excel файла, если он доступен.

## Пример 10: Обработка ошибок

### Пример ошибки валидации сценариев:

```
[1/8] Загрузка данных...
  ✗ Ошибка валидации: Этап 1: сумма вероятностей = 0.95, ожидается 1.0
```

### Пример ошибки инициализации портфеля:

```
[2/8] Инициализация портфеля...
  ✗ Ошибка инициализации: Начальный портфель не удовлетворяет ограничениям: Portfolio(cb1=20.0, cb2=800.0, dep=400.0, cash=600.0)
```

Программа корректно обрабатывает ошибки и выводит понятные сообщения.
